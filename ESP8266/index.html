<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name=google value=notranslate>
<title>ESP8266 Blockly for MicroPython</title>
<script>function setCookie(cname,cvalue,cpassword_value,exdays){var d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"&"+"last_pass="+cpassword_value+";"+expires+";path=/";}
function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(';');console.log(ca)
for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";}
function checkCookie(){var cookies=getCookie("last_ip");if(cookies!=""){var cookies_=cookies.split('&')
document.getElementById('url').value=cookies_[0]
document.getElementById('password').value=cookies_[1].substring("last_pass=".length,cookies_[0].length)}}
window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-162001686-1');</script>
<style>html{background:#555}h1{margin-bottom:20px;font:20px/1.5 sans-serif}.file-box{margin:4px;padding:4px;background:#888}</style>
<link rel=stylesheet href=style.css>
<script src=storage.js></script>
<script src=blockly_compressed.js></script>
<script src=blocks_compressed.js></script>
<script src=javascript_compressed.js></script>
<script src=python_compressed.js></script>
<script src=code.js></script>
<script src=block_definitions.js></script>
<script src=generator_stubs.js></script>
<script src=FileSaver.js></script>
<script type=module>
  // This is the "Offline copy of pages" service worker

/*
 This code uses the pwa-update web component https://github.com/pwa-builder/pwa-update to register your service worker, tell the user when there is an update available and let the user know when your PWA is ready to use offline.

*/

//import 'https://cdn.jsdelivr.net/npm/@pwabuilder/pwaupdate';
//const el = document.createElement('pwa-update');
//document.body.appendChild(el);

</script>
</head>
<body>
<table width=100% height=100%>
<tr>
<td>
<h1>
<span id=title>
ESP8266 Blockly for MicroPython (<a href=http://www.bipes.net.br target=_blank>BIPES</a>)
</span>
</h1>
</td>
<td class=farSide>
<select id=languageMenu></select>
</td>
</tr>
<tr>
<td colspan=2>
<table width=100%>
<tr id=tabRow height=1em>
<td id=tab_blocks class=tabon>...</td>
<td class=tabmin>&nbsp;</td>
<td id=tab_python class=taboff>MicroPython</td>
<td class=tabmin>&nbsp;</td>
<td id=tab_device class=taboff>Device</td>
<td class=tabmin>&nbsp;</td>
<td id=tab_xml class=taboff>XML</td>
<td style=visibility:hidden id=tab_console class=taboff>Console</td>
<td style=visibility:hidden class=tabmin>&nbsp;</td>
<td style=visibility:hidden id=tab_files class=taboff>Files</td>
<td style=visibility:hidden class=tabmin>&nbsp;</td>
<td style=visibility:hidden id=tab_programs class=taboff>Shared</td>
<td style=visibility:hidden class=tabmin>&nbsp;</td>
<td style=visibility:hidden id=tab_iot class=taboff>IOT</td>
<td style=visibility:hidden class=tabmin>&nbsp;</td>
<td style=visibility:hidden id=tab_mqtt class=taboff onclick='document.getElementById("easymqtt_iframe").contentWindow.startEasyMQTT(window.easyMQTT_session)'>EasyMQTT</td>
<td style=visibility:hidden class=tabmin>&nbsp;</td>
<td class=tabmax>
<script>function loadFileToElement(filename,elementId)
{var xmlHTTP=new XMLHttpRequest();try
{xmlHTTP.open("GET",filename,false);xmlHTTP.send(null);}
catch(e){window.alert("Unable to load the requested file.");return;}
document.getElementById(elementId).innerHTML=xmlHTTP.responseText;}
var pinout={'ESP8266':[['D0-GPIO16',"16"],['D1-GPIO5',"5"],['D2-GPIO4',"4"],['D3-GPIO0',"0"],['D4-GPIO2/LED',"2"],['D5-GPIO14',"14"],['D6-GPIO12',"12"],['D7-GPIO13',"13"],['D8-GPIO15',"15"],['RX-GPIO3',"3"],['TX-GPIO1',"1"],['SD3-GPIO10',"10"],['SD2-GPIO9',"9"],['SD1-GPIO8',"8"],['CMD-GPIO11',"11"],['SD0-GPIO7',"7"],['CLK-GPIO6',"6"]]};function changeDevice(dev){if(dev=='ESP8266'){document.getElementById('device_title').innerHTML='<b>ESP8266</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/Node-MCU-ESP-12E-Pin-Out-Diagram2.jpg";document.getElementById("device_desc").innerHTML="<BR><BR><input type='button' onclick='loadDoc(\"\");' value='Open Documentation' /> <BR><BR>To use ESP8266, simply connecto to MicroPython board using Wifi. Micropython must be previously installed.";loadFileToElement('toolbox_esp8266.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));}
else if(dev=='wemos_d1_mini'){document.getElementById('device_title').innerHTML='<b>ESP8266 - Wemos D1 Mini</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/Wemos-D1-Mini.png";document.getElementById("device_desc").innerHTML="<BR><BR><input type='button' onclick='loadDoc(\"\");' value='Open Documentation' /> <BR><BR>To use ESP8266, simply connecto to MicroPython board using Wifi. Micropython must be previously installed. Figure source: https://devonhubner.org/Using_MicroPython_with_a_WeMos_D1_Mini/";loadFileToElement('toolbox_esp8266.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));}
else if(dev=='ESP32-oled'){document.getElementById('device_title').innerHTML='<b>ESP32 board with OLED LCD and Battery</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/esp32-oled.png";loadFileToElement('toolbox_esp32.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));document.getElementById("device_desc").innerHTML="Yet another ESP32 board";}
else if(dev=='ESP32'){document.getElementById('device_title').innerHTML='<b>ESP32</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/ESP32-Pinout.jpg";loadFileToElement('toolbox_esp32.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));}
else if(dev=='M5STICK'){document.getElementById('device_title').innerHTML='<b>ESP32</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/m5stickc.png";loadFileToElement('toolbox_esp32.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));document.getElementById("device_desc").innerHTML="M5STICK-C is based on ESP32 processor. More info at:";}
else if(dev=='Nucleo'){document.getElementById('device_title').innerHTML='<b>mBed: NUCLEO-F446RE</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/NUCLEO-F446RE-3-500x500.png";}
else if(dev=='RPI4'){document.getElementById('device_title').innerHTML='<b>Raspberry Pi 4 </b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/rpi4.png";loadFileToElement('toolbox_linux.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));document.getElementById("device_desc").innerHTML="Use Raspberry Pi 4 with WebSocketServerREPL. For OpenCV features, please install opencv with apt install python-opencv";}
else if(dev=='EV3'){document.getElementById('device_title').innerHTML='<b>Lego EV3 </b><br>';document.getElementById("device_img").src="";document.getElementById("device_desc").innerHTML="Help needed! We need a Lego EV3 to build the blocks to the intelligent brick, or help us designing the blocks, if you have an EV3 Inteligent Brick!";}
else if(dev=='BBBlack'){document.getElementById('device_title').innerHTML='<b>Beagle Bone Black</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/cape-headers.png";loadFileToElement('toolbox_bbblack.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));}
else if(dev=='BBC'){document.getElementById('device_title').innerHTML='<b>BBC MicroBit</b><br>';document.getElementById("device_img").src="http://bipes.net.br/beta2/ui/devinfo/microbit.png";loadFileToElement('toolbox_esp32.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));document.getElementById("device_desc").innerHTML="Image source and more info: <a href=https://microbit.org/get-started/user-guide/features-in-depth/>https://microbit.org/get-started/user-guide/features-in-depth/</a>";}
else if(dev=='RPI'){}
else if(dev=='UNO'){document.getElementById('device_title').innerHTML='<b>Arduino UNO. Image source: https://content.arduino.cc/assets/Pinout-UNOrev3_latest.png</b><br>';document.getElementById("device_img").src="https://content.arduino.cc/assets/Pinout-UNOrev3_latest.png";loadFileToElement('toolbox_arduino.xml','toolbox');Code.workspace.updateToolbox(document.getElementById('toolbox'));}
else{alert("Invalid Device");}}
function installLib(){alert('This will download and install the library. Your board must be connected to the Internet');}</script>
Device:
<select id=device_selector onchange=changeDevice(this.value)>
<option value=ESP8266>Wemos D1 mini</option>
</select>
<button style=display:none id=runButton class="notext primary" title=...>
<img src=media/1x1.gif class="run icon21">
</button>
<button style=display:none id=linkButton class=notext title=...>
<img src=media/1x1.gif class="link icon21">
</button>
<button id=saveButton class=notext title=...>
<img src=media/1x1.gif class="save icon22">
</button>
<button id=loadButton class=notext title=...>
<img src=media/1x1.gif class="load icon22">
</button>
<input type=file id=load style="display:none"/>
<button id=trashButton class=notext title=...>
<img src=media/1x1.gif class="trash icon21">
</button>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td height=99% colspan=2 id=content_area>
</td>
</tr>
</table>
<div id=content_blocks class=content></div>
<div id=content_console class=content>
<tr height=25% id=termTR>
<td>
<form>
Address: <input type=text name=webrepl_url id=url value=ws://192.168.0.35:8266/ />
Password: <input type=text name=webrepl_pass id=password value=bipes />
<input type=submit id=button value=Connect onclick="button_click();return false" />
</form>
<div style=display:inline-block;vertical-align:top>
<div id=term>
</div>
</div>
</td>
<td>
<div id=file-boxes style=display:inline-block;vertical-align:top;width:230px>
<input type=button value="Run block based program" onclick="runPython();return false" />
<br>
<br>
<input type=button value="Stop running program" onclick="stopPython();return false" />
<br>
<br>
<input type=button value="Run edited Python File" onclick="files_run(document.getElementById('content_file_name').value);return false" />
<br>
<br>
<input type=button value="Clear terminal output" onclick="term.write('\x1bc')" />
</div>
</td>
</tr>
</div>
<pre id=content_python class=content></pre>
<textarea id=content_xml class=content wrap=off readonly></textarea>
<div id=content_programs class=content>
<center>
</center>
</div>
<div id=content_device class=content>
<center>
<label id=device_title><b>Wemos D1 Mini - Witty Cloud</b><br></label>
<hr>
<img id=device_img src=devinfo/Wemos-D1-Mini-big-Witty.png width=85%>
<br>
<label id=device_desc>
<BR><BR><input type=button onclick=loadDoc() value='Open Documentation' /> <BR><BR>To use ESP8266, simply connecto to MicroPython board using Wifi. Micropython must be previously installed on the board. Follow these instructions to install it.
</label>
</center>
</div>
<div id=content_files class=content>
<div style=width:50%;float:left>
<center>
Text editor for files in device's filesystem:
</center>
<br>
<textarea id=content_file_code cols=90 rows=20 wrap=off></textarea>
<br>
Save as:
<input type=text id=content_file_name>
<input type=button value=Save onclick="files_save_as();return false" />
<input type=button value=Run onclick="files_run(document.getElementById('content_file_name').value);return false" />
<input type=button value=Stop onclick="stopPython();return false" />
<script>function getText(pName){var request=new XMLHttpRequest();request.open('GET','http://bipes.net.br/beta2/ui/pylibs/'+pName,true);request.send(null);request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){var type=request.getResponseHeader('Content-Type');if(type.indexOf("text")!==1){var Textarea=document.getElementById('content_file_code');editor.getDoc().setValue(request.responseText);var TextareaF=document.getElementById('content_file_name');TextareaF.value=pName;return request.responseText;}}}}</script>
<br>
<br>
Python code templates and libraries:
<br>
(libraries and startup codes to load and send to your board)
<br>
<input type=button value=main.py onclick="getText('main.py');return false" />
<input type=button value=SSD1306.py onclick="getText('SSD1306.py');return false" />
</div>
<div style=width:50%;float:right>
<center>
Device file manager
<br>
<div id=file-boxes style=display:inline-block;vertical-align:top;width:230px>
<input type=button value="Run Blocks" onclick="runPython();return false" />
<input type=button value="List Files" onclick="listFiles();return false" />
<br>
<input type=button value="Blocks to editable Python (here)" onclick="blocksToPython();return false" />
<div class=file-box>
<strong>Send a file</strong>
<input type=file id=put-file-select />
<div id=put-file-list></div>
<input type=button value="Send to device" id=put-file-button onclick="put_file();return false" />
</div>
<div class=file-box id=file-status><span style=color:#707070>(file operation status)</span></div>
</div>
</td>
</div>
<center>
<br>
<br>
<div id=fileList>
List of files will be shown here.
</div>
</div>
<div id=content_iot class=content>
<center>
<iframe></iframe>
<center>
</div>
<div id=content_mqtt class=content style=padding:0>
<iframe></iframe>
</div>
<xml id=toolbox style=display:none>
<category name=%{BKY_CATLOGIC} colour=%{BKY_LOGIC_HUE}>
<block type=controls_if></block>
<block type=logic_compare></block>
<block type=logic_operation></block>
<block type=logic_negate></block>
<block type=logic_boolean></block>
<block type=logic_null></block>
<block type=logic_ternary></block>
</category>
<category name=%{BKY_CATLOOPS} colour=%{BKY_LOOPS_HUE}>
<block type=controls_repeat_ext>
<value name=TIMES>
<shadow type=math_number>
<field name=NUM>10</field>
</shadow>
</value>
</block>
<block type=controls_whileUntil></block>
<block type=controls_for>
<value name=FROM>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
<value name=TO>
<shadow type=math_number>
<field name=NUM>10</field>
</shadow>
</value>
<value name=BY>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
<block type=controls_forEach></block>
<block type=controls_flow_statements></block>
</category>
<category name=%{BKY_CATMATH} colour=%{BKY_MATH_HUE}>
<block type=math_number>
<field name=NUM>123</field>
</block>
<block type=math_arithmetic>
<value name=A>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
<value name=B>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
<block type=math_single>
<value name=NUM>
<shadow type=math_number>
<field name=NUM>9</field>
</shadow>
</value>
</block>
<block type=math_trig>
<value name=NUM>
<shadow type=math_number>
<field name=NUM>45</field>
</shadow>
</value>
</block>
<block type=math_constant></block>
<block type=math_number_property>
<value name=NUMBER_TO_CHECK>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
</block>
<block type=math_round>
<value name=NUM>
<shadow type=math_number>
<field name=NUM>3.1</field>
</shadow>
</value>
</block>
<block type=math_on_list></block>
<block type=math_modulo>
<value name=DIVIDEND>
<shadow type=math_number>
<field name=NUM>64</field>
</shadow>
</value>
<value name=DIVISOR>
<shadow type=math_number>
<field name=NUM>10</field>
</shadow>
</value>
</block>
<block type=math_constrain>
<value name=VALUE>
<shadow type=math_number>
<field name=NUM>50</field>
</shadow>
</value>
<value name=LOW>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
<value name=HIGH>
<shadow type=math_number>
<field name=NUM>100</field>
</shadow>
</value>
</block>
<block type=math_random_int>
<value name=FROM>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
<value name=TO>
<shadow type=math_number>
<field name=NUM>100</field>
</shadow>
</value>
</block>
<block type=math_random_float></block>
<block type=var_to_int>
<field name=VAR>to int</field>
</block>
<block type=var_to_float>
<field name=VAR>to float</field>
</block>
</category>
<category name=%{BKY_CATTEXT} colour=%{BKY_TEXTS_HUE}>
<block type=text></block>
<block type=text_join></block>
<block type=text_append>
<value name=TEXT>
<shadow type=text></shadow>
</value>
</block>
<block type=text_length>
<value name=VALUE>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_isEmpty>
<value name=VALUE>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=text_indexOf>
<value name=VALUE>
<block type=variables_get>
<field name=VAR>{textVariable}</field>
</block>
</value>
<value name=FIND>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_charAt>
<value name=VALUE>
<block type=variables_get>
<field name=VAR>{textVariable}</field>
</block>
</value>
</block>
<block type=text_getSubstring>
<value name=STRING>
<block type=variables_get>
<field name=VAR>{textVariable}</field>
</block>
</value>
</block>
<block type=text_changeCase>
<value name=TEXT>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_trim>
<value name=TEXT>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_print>
<value name=TEXT>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_prompt_ext>
<value name=TEXT>
<shadow type=text>
<field name=TEXT>abc</field>
</shadow>
</value>
</block>
<block type=text_to_str>
<field name=VAR>to str</field>
</block>
<block type=decode_bytes_to_text>
<field name=VAR>decode bytes to text</field>
</block>
</category>
<category name=%{BKY_CATLISTS} colour=%{BKY_LISTS_HUE}>
<block type=lists_create_with>
<mutation items=0></mutation>
</block>
<block type=lists_create_with></block>
<block type=lists_repeat>
<value name=NUM>
<shadow type=math_number>
<field name=NUM>5</field>
</shadow>
</value>
</block>
<block type=lists_length></block>
<block type=lists_isEmpty></block>
<block type=lists_indexOf>
<value name=VALUE>
<block type=variables_get>
<field name=VAR>{listVariable}</field>
</block>
</value>
</block>
<block type=lists_getIndex>
<value name=VALUE>
<block type=variables_get>
<field name=VAR>{listVariable}</field>
</block>
</value>
</block>
<block type=lists_setIndex>
<value name=LIST>
<block type=variables_get>
<field name=VAR>{listVariable}</field>
</block>
</value>
</block>
<block type=lists_getSublist>
<value name=LIST>
<block type=variables_get>
<field name=VAR>{listVariable}</field>
</block>
</value>
</block>
<block type=lists_split>
<value name=DELIM>
<shadow type=text>
<field name=TEXT>,</field>
</shadow>
</value>
</block>
<block type=lists_sort></block>
</category>
<sep></sep>
<category name=%{BKY_CATVARIABLES} colour=%{BKY_VARIABLES_HUE} custom=VARIABLE></category>
<category name=%{BKY_CATFUNCTIONS} colour=%{BKY_PROCEDURES_HUE} custom=PROCEDURE></category>
<sep></sep>
<category name=Python>
<label text=Python></label>
<block type=exec_import_python_module>
<value name=command>
<shadow type=text>
<field name=TEXT>import xtools</field>
</shadow>
</value>
</block>
<block type=exec_python>
<value name=command>
<shadow type=text>
<field name=TEXT>id = xtools.get_id()</field>
</shadow>
</value>
</block>
<block type=exec_python_output>
<field name=EXEC_PYTHON_OUTPUT>Set custom Python value</field>
<value name=command>
<shadow type=text>
<field name=TEXT>{'name':'joe', 'score':20}</field>
</shadow>
</value>
</block>
<block type=exec_python_func>
<field name=EXEC_PYTHON_FUNC>Call custom Python func</field>
<value name=command>
<shadow type=text>
<field name=TEXT>xtools.get_num('Price: 199.9')</field>
</shadow>
</value>
</block>
<block type=dicts_create_with></block>
<block type=dict_get></block>
<block type=python_try_catch></block>
</category>
<category name=Timing>
<label text=Timing></label>
<block type=delay>
<value name=time>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
<block type=delay_ms>
<value name=time>
<shadow type=math_number>
<field name=NUM>1000</field>
</shadow>
</value>
</block>
<block type=delay_us>
<value name=time>
<shadow type=math_number>
<field name=NUM>1000000</field>
</shadow>
</value>
</block>
<block type=ticks_ms></block>
<block type=ticks_diff></block>
<block type=set_rtc></block>
<block type=get_rtc></block>
<block type=get_rtc_datetime></block>
<block type=timer></block>
<block type=stop_timer>
<value name=timerNumber>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
</block>
<block type=deep_sleep8266>
<value name=interval>
<shadow type=math_number>
<field name=NUM>60</field>
</shadow>
</value>
</block>
</category>
</category>
<category name=Machine>
<category name=CPU>
<label text="ESP8266 CPU"></label>
<block type=get_freq></block>
<block type=set_freq>
<value name=freq>
<shadow type=math_number>
<field name=NUM>160000000</field>
</shadow>
</value>
</block>
<block type=reset></block>
<block type=soft_reset></block>
<block type=machine_unique_id></block>
<block type=machine_reset_cause></block>
<block type=reset_cause_soft></block>
<block type=reset_cause_hard></block>
<block type=reset_cause_wdt></block>
<block type=reset_cause_deep></block>
</category>
<category name="In/Out Pins">
<label text="Auto Declare In/Out Pin Variables"></label>
<block type=gpio_set>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=value>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<block type=gpio_get_out>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=gpio_get>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=adc>
<value name=pin>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
</block>
<block type=pwm>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=frequency>
<shadow type=math_number>
<field name=NUM>1000</field>
</shadow>
</value>
<value name=duty>
<shadow type=math_number>
<field name=NUM>50</field>
</shadow>
</value>
</block>
<block type=pwm_duty>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=duty>
<shadow type=math_number>
<field name=NUM>50</field>
</shadow>
</value>
</block>
<label text="Use Pin Number"></label>
<block type=gpio_set_mehtod_chaining>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=value>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<block type=pinout></block>
<label text="Create Pin/PWM Objects"></label>
<block type=gpio_create_pinobj>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=gpio_set_pinobj>
<value name=value>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<block type=gpio_create_pwmobj>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=frequency>
<shadow type=math_number>
<field name=NUM>1000</field>
</shadow>
</value>
<value name=duty>
<shadow type=math_number>
<field name=NUM>50</field>
</shadow>
</value>
</block>
<block type=gpio_pwmobj_duty>
<value name=duty>
<shadow type=math_number>
<field name=NUM>50</field>
</shadow>
</value>
</block>
</category>
</category>
<category name=Displays>
<category name="Character display">
<label text="PCF8574 Display controller"></label>
<label text="Library: esp8266_i2c_lcd.py"></label>
<block type=char_lcd_init>
<value name=scl>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=sda>
<shadow type=pinout>
<field name=PIN>4</field>
</shadow>
</value>
<value name=lines>
<shadow type=math_number>
<field name=NUM>2</field>
</shadow>
</value>
<value name=columns>
<shadow type=math_number>
<field name=NUM>16</field>
</shadow>
</value>
</block>
<block type=char_lcd_clear></block>
<block type=char_lcd_putstr>
<value name=text>
<shadow type=text>
<field name=TEXT>Hello</field>
</shadow>
</value>
</block>
<block type=char_lcd_moveto>
<value name=x>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=y>
<shadow type=math_number>
<field name=0>4</field>
</shadow>
</value>
</block>
<block type=char_lcd_backlight>
<value name=state>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<block type=char_lcd_display>
<value name=state>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<label text=https://github.com/dhylands/python_lcd></label>
</category>
<category name="OLED display">
<label text="SSD1306 OLED I2C Display"></label>
<label text="Library: SSD1306.py"></label>
<block type=init_oled>
<value name=scl>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=sda>
<shadow type=pinout>
<field name=PIN>4</field>
</shadow>
</value>
<value name=width>
<shadow type=math_number>
<field name=NUM>128</field>
</shadow>
</value>
<value name=height>
<shadow type=math_number>
<field name=NUM>64</field>
</shadow>
</value>
</block>
<block type=power_oled>
<value name=state>
<shadow type=logic_boolean>
<field name=BOOL></field>
</shadow>
</value>
</block>
<block type=write_oled>
<value name=x>
<shadow type=math_number>
<field name=NUM>40</field>
</shadow>
</value>
<value name=y>
<shadow type=math_number>
<field name=NUM>40</field>
</shadow>
</value>
<value name=text>
<shadow type=text>
<field name=TEXT>Hello</field>
</shadow>
</value>
</block>
<block type=show_oled></block>
<block type=clear_oled></block>
<block type=fill_oled>
<value name=value>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
</category>
<category name="LED Matrix">
<label text="MAX7219 LED Matrix"></label>
<label text="Library: max7219.py"></label>
<block type=max7219_init>
<value name=din>
<shadow type=pinout>
<field name=PIN>13</field>
</shadow>
</value>
<value name=cs>
<shadow type=pinout>
<field name=PIN>15</field>
</shadow>
</value>
<value name=clk>
<shadow type=pinout>
<field name=PIN>14</field>
</shadow>
</value>
<value name=num>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
<block type=max7219_brightness>
<value name=value>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
</block>
<block type=max7219_clear></block>
<block type=max7219_write>
<value name=x>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=y>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=text>
<shadow type=text>
<field name=TEXT>Hello</field>
</shadow>
</value>
</block>
<block type=max7219_show></block>
<block type=max7219_scroll>
<value name=delayms>
<shadow type=math_number>
<field name=NUM>30</field>
</shadow>
</value>
<value name=text>
<shadow type=text>
<field name=TEXT>Hello Worlds!</field>
</shadow>
</value>
</block>
<label text=https://github.com/mcauser/micropython-max7219></label>
</category>
</category>
<category name=Sensors>
<category name="DHT11/22 Sensor">
<label text="DHT11/22 Temperature and Humidity Sensor"></label>
<block type=dht_init>
<field name=BLOCK_DHT_INIT>Init DHT11/22 sensor</field>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=dht_measure>
<field name=MSG_MEASURE_DHT>Measure DHT11/22 Sensor</field>
</block>
<block type=dht_read_temp>
<field name=MSG_READ_DHT_TEMP>Read DHT11/22 Temperature</field>
</block>
<block type=dht_read_humidity>
<field name=MSG_READ_DHT_HUMI>Read DHT11/22 Humidity</field>
</block>
</category>
<category name="HC-SR04 Ultrasound">
<label text="HC-SR04 ultrasound distance sensor"></label>
<label text="Library: hcsr04.py"></label>
<block type=hcsr_init>
<field name=BLOCK_HCSR_INIT>Init HC-SR04 Ultrasound sensor</field>
<value name=echo>
<shadow type=pinout>
<field name=PIN>4</field>
</shadow>
</value>
<value name=trigger>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=timeout>
<shadow type=math_number>
<field name=NUM>30000</field>
</shadow>
</value>
</block>
<block type=hcsr_read>
</block>
<label text=https://github.com/rsc1975/micropython-hcsr04></label>
</category>
<category name="MPU6050 InvenSense">
<label text="MPU6050 IMU"></label>
<label text="Library: imu.py"></label>
<block type=init_mpu6050></block>
<block type=mpu6050_read_acc_x> </block>
<block type=mpu6050_read_acc_y> </block>
<block type=mpu6050_read_acc_z> </block>
<block type=mpu6050_read_gyro_x> </block>
<block type=mpu6050_read_gyro_y> </block>
<block type=mpu6050_read_gyro_z> </block>
<label text=https://github.com/nihalpasham/micropython_sensorfusion></label>
</category>
<category name="OneWire: DS18x20">
<label text="OneWire: DS18x20 Temperature Sensor"></label>
<block type=onewire_ds18x20_init>
<value name=pin>
<shadow type=pinout>
<field name=PIN>4</field>
</shadow>
</value>
</block>
<block type=onewire_ds18x20_scan></block>
<block type=onewire_ds18x20_convert></block>
<block type=onewire_ds18x20_read_temp></block>
</category>
<category name="RFID Reader">
<label text="RC522 13.56MHz RFID Reader"></label>
<label text="Library: mfrc522.py"></label>
<block type=rfid_rc522_init>
<value name=sck>
<shadow type=pinout>
<field name=PIN>0</field>
</shadow>
</value>
<value name=mosi>
<shadow type=pinout>
<field name=PIN>2</field>
</shadow>
</value>
<value name=miso>
<shadow type=pinout>
<field name=PIN>4</field>
</shadow>
</value>
<value name=rst>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=sda>
<shadow type=pinout>
<field name=PIN>14</field>
</shadow>
</value>
</block>
<block type=rfid_rc522_detect_card></block>
<block type=rfid_rc522_ok></block>
<block type=rfid_rc522_anticoll></block>
<block type=rfid_rc522_get_uid_string></block>
<label text=https://github.com/wendlers/micropython-mfrc522></label>
</category>
<category name=NeoPixel>
<label text="NeoPixel WS2812B Addressable RGB LEDs"></label>
<block type=neopixel_initialise>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
</block>
<block type=neopixel_clear>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
</block>
<block type=neopixel_show>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
</block>
<block type=neopixel_set>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=pixel>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=red>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=green>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=blue>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
</block>
<block type=neopixel_bounce>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=red>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=green>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=blue>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=delay>
<shadow type=math_number>
<field name=NUM>100</field>
</shadow>
</value>
</block>
<block type=neopixel_cycle>
<value name=pin>
<shadow type=pinout>
<field name=PIN>5</field>
</shadow>
</value>
<value name=red>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=green>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=blue>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=delay>
<shadow type=math_number>
<field name=NUM>100</field>
</shadow>
</value>
</block>
</category>
</category>
<category name=Actuators>
<category name=Relay>
<label text=Relay></label>
<block type=relay_switch>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
</category>
<category name="RC Servo Motor">
<label text="Hobby RC Servo Motor"></label>
<block type=init_servo>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=move_servo>
<value name=pin>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=angle>
<shadow type=math_number>
<field name=NUM>90</field>
</shadow>
</value>
</block>
</category>
<category name="Stepper Motor">
<label text="Stepper Motor"></label>
<block type=stepper_init>
<value name=p0>
<shadow type=pinout>
<field name=Pin0></field>
</shadow>
</value>
<value name=p1>
<shadow type=pinout>
<field name=Pin1></field>
</shadow>
</value>
<value name=p2>
<shadow type=pinout>
<field name=Pin2></field>
</shadow>
</value>
<value name=p3>
<shadow type=pinout>
<field name=Pin3></field>
</shadow>
</value>
</block>
<block type=stepper_step>
<value name=steps>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
</category>
<category name="DC Motor">
<label text="DC Motor"></label>
<block type=dc_motor_init>
<value name=pwm>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=dir1>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
<value name=dir2>
<shadow type=pinout>
<field name=PIN></field>
</shadow>
</value>
</block>
<block type=dc_motor_power>
<value name=power>
<shadow type=math_number>
<field name=NUM>70</field>
</shadow>
</value>
</block>
<block type=dc_motor_direction>
<value name=dir>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
</block>
<block type=dc_motor_stop>
</block>
</category>
</category>
</category>
<category name=Files>
<category name="Text Files">
<label text="Read and write files"></label>
<block type=file_open_write>
<value name=filename>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=file_open_read>
<value name=filename>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=file_write>
<value name=data>
<shadow type=text>
<field name=TEXT>File contents</field>
</shadow>
</value>
<value name=filename>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=file_read>
<value name=filename>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=file_close>
<value name=filename>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=files_list></block>
</category>
<category name="Disk Files">
<label text="Disk file operations"></label>
<block type=uos_mkdir>
<value name=pIn>
<shadow type=text>
<field name=TEXT>temp_path</field>
</shadow>
</value>
</block>
<block type=uos_remove>
<value name=pIn>
<shadow type=text>
<field name=TEXT>file.txt</field>
</shadow>
</value>
</block>
<block type=uos_listdir>
</block>
<block type=uos_chdir>
</block>
<block type=uos_getcwd>
</block>
<block type=uos_ilistdir>
</block>
<block type=uos_rmdir>
</block>
<block type=uos_rename>
</block>
</category>
</category>
<category name=Network>
<block type=wifi_client_connect>
<field name=NAME>Connect to Wifi network</field>
<value name=wifi_client_essid>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=wifi_client_key>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=net_ap_mode>
<field name=NAME>Configure Access Point Mode</field>
<value name=wifi_essid>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=wifi_key>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=wifi_client_scan_networks>
<field name=NET_SCAN_WIFI>Scan Wifi networks</field>
</block>
<block type=net_ifconfig>
<field name=NET_IFCONFIG>Wifi current IP</field>
</block>
<block type=net_isconnected>
<field name=NET_ISCONNECTED>Wifi is connected?</field>
</block>
<block type=net_disconnect></block>
<category name="HTTP Client">
<label text="HTTP Client"></label>
<block type=net_get_request>
<field name=BLOCK_NET_GET>Make HTTP GET Request URL</field>
</block>
<block type=net_response_statuscode>
<field name=BLOCK_NET_STATUSCODE>Get status code</field>
</block>
<block type=net_response_text>
<field name=BLOCK_NET_TEXT>Get text</field>
</block>
<block type=net_response_encoding>
<field name=BLOCK_NET_ENCODING>Get encoding</field>
</block>
<block type=net_response_json>
<field name=BLOCK_NET_JSON>Get JSON</field>
</block>
<block type=net_response_json_get></block>
<block type=net_post_request>
<field name=NET_POST_REQUEST_URL>Make HTTP POST Request URL</field>
<field name=NET_POST_REQUEST_DATA>data</field>
</block>
<label text="Library: xrequests.py"></label>
<block type=net_get_request_params>
<field name=NET_POST_REQUEST_URL3>Make xrequests GET Request URL</field>
<field name=NET_POST_REQUEST_PARAMS>params</field>
</block>
<block type=net_post_request_header>
<field name=NET_POST_REQUEST_URL2>Make xrequests POST Request URL</field>
</block>
<block type=net_post_request_json>
<field name=NET_POST_REQUEST_URL4>Make xrequests POST Request URL</field>
</block>
</category>
<category name="NTP Time">
<label text="Network Time Protocol (NTP)"></label>
<label text="Adjusts RTC using Internet"></label>
<block type=net_ntp_sync>
<value name=tz>
<shadow type=math_number>
<field name=NUM>8</field>
</shadow>
</value>
</block>
<block type=net_get_ntp></block>
</category>
<category name=MQTT>
<label text="MQTT (Message Queue Telemetry Transport)"></label>
<block type=mqtt_init>
<field name=BLOCK_MQTT_INIT>Init MQTT client</field>
<value name=clientid>
<shadow type=text>
<field name=TEXT>mqtt_client_id</field>
</shadow>
</value>
<value name=server>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=port>
<shadow type=math_number>
<field name=NUM>1883</field>
</shadow>
</value>
<value name=user>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=password>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=mqtt_connect>
<field name=BLOCK_MQTT_DISCONNECT>Connect MQTT client</field>
</block>
<block type=mqtt_disconnect>
<field name=BLOCK_MQTT_DISCONNECT>Disconnect MQTT client</field>
</block>
<block type=mqtt_publish_payload>
<field name=BLOCK_MQTT_PUBLISH>Publish payload to MQTT topic</field>
<value name=topic>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=payload>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=mqtt_set_callback>
<field name=BLOCK_MQTT_SET_CALLBACK>Set callback to MQTT messages</field>
</block>
<block type=mqtt_subscribe>
<field name=BLOCK_MQTT_SUBSCRIBE>Subscribe to MQTT topic</field>
<value name=topic>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
</block>
<block type=mqtt_check_msg>
<field name=BLOCK_MQTT_CHECK_MSG>Check for MQTT server messages</field>
</block>
<block type=mqtt_wait_msg>
<field name=BLOCK_MQTT_WAIT_MSG>Wait for MQTT server messages</field>
</block>
</category>
<category name="TCP/IP Socket">
<label text="TCP/IP Socket"></label>
<block type=net_socket_connect>
<value name=host>
<shadow type=text>
<field name=TEXT>towel.blinkenlights.nl</field>
</shadow>
</value>
<value name=port>
<shadow type=math_number>
<field name=NUM>23</field>
</shadow>
</value>
</block>
<block type=net_socket_receive>
<value name=bytes>
<shadow type=math_number>
<field name=NUM>500</field>
</shadow>
</value>
</block>
<block type=net_socket_send>
<value name=bytes>
<shadow type=text>
<field name=TEXT>Hello</field>
</shadow>
</value>
</block>
<block type=net_socket_close>
</block>
</category>
<category name="HTTP Server">
<label text="HTTP Web Server"></label>
<block type=net_http_server_start>
<value name=port>
<shadow type=math_number>
<field name=NUM>80</field>
</shadow>
</value>
</block>
<block type=net_http_server_accept>
</block>
<block type=net_http_server_requested_page>
</block>
<block type=net_http_server_send_response>
<value name=html>
<shadow type=text>
<field name=TEXT>You reached MicroPython WebServer!</field>
</shadow>
</value>
</block>
<block type=net_http_server_close>
</block>
</category>
</category>
<category name=Modules>
<category name=ujson>
<block type=ujson_dumps>
</block>
<block type=ujson_loads>
</block>
<block type=net_response_json_get></block>
</category>
<category name=xtools>
<label text="Library: xtools.py"></label>
<block type=xtools_get_id></block>
<block type=xtools_get_num>
<value name=text_str>
<shadow type=text>
<field name=TEXT>Price: 199.9</field>
</shadow>
</value>
</block>
<block type=xtools_random_in_range>
<value name=low>
<shadow type=math_number>
<field name=NUM>1</field>
</shadow>
</value>
<value name=high>
<shadow type=math_number>
<field name=NUM>100</field>
</shadow>
</value>
</block>
<block type=xtools_map_range>
<value name=in_min>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=in_max>
<shadow type=math_number>
<field name=NUM>1024</field>
</shadow>
</value>
<value name=out_min>
<shadow type=math_number>
<field name=NUM>0</field>
</shadow>
</value>
<value name=out_max>
<shadow type=math_number>
<field name=NUM>255</field>
</shadow>
</value>
</block>
<block type=xtools_connect_wifi>
<value name=ssid>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=pwd>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=timeout>
<shadow type=math_number>
<field name=NUM>15</field>
</shadow>
</value>
</block>
<block type=xtools_connect_wifi_ip>
<value name=ssid>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=pwd>
<shadow type=text>
<field name=TEXT></field>
</shadow>
</value>
<value name=timeout>
<shadow type=math_number>
<field name=NUM>15</field>
</shadow>
</value>
</block>
<block type=xtools_webhook_post></block>
<block type=xtools_webhook_get></block>
<label text="Library: xrequests.py"></label>
<block type=xtools_line_msg></block>
</category>
<category name=xrequests>
<label text="Library: xrequests.py"></label>
<block type=net_get_request_params>
<field name=NET_POST_REQUEST_URL3>Make xrequests GET Request URL</field>
<field name=NET_POST_REQUEST_PARAMS>params</field>
</block>
<block type=net_post_request_header>
<field name=NET_POST_REQUEST_URL2>Make xrequests POST Request URL</field>
</block>
<block type=net_post_request_json>
<field name=NET_POST_REQUEST_URL4>Make xrequests POST Request URL</field>
</block>
</category>
</category>
</category>
</category>
</xml>
</body>
<script>;var term;var ws;var connected=false;var binary_state=0;var put_file_name=null;var put_file_data=null;var get_file_name=null;var get_file_data=null;var received_string="";var viewOnly=false;function calculate_size(win){var cols=120;var rows=25;return[cols,rows];}
(function(){window.onload=function(){checkCookie()};window.addEventListener('resize',function(){});}).call(this);function show_https_warning(){if(window.location.protocol=='https:'){var warningDiv=document.createElement('div');warningDiv.style.cssText='background:#f99;padding:5px;margin-bottom:10px;line-height:1.5em;text-align:center';warningDiv.innerHTML=['At this time, the WebREPL client cannot be accessed over HTTPS connections.','Use a HTTP connection, eg. <a href="http://micropython.org/webrepl/">http://micropython.org/webrepl/</a>.','Alternatively, download the files from <a href="https://github.com/micropython/webrepl">GitHub</a> and run them locally.'].join('<br>');document.body.insertBefore(warningDiv,document.body.childNodes[0]);term.resize(term.cols,term.rows-7);}}
function button_click(){if(connected){ws.close();}else{setCookie("last_ip",document.getElementById('url').value,document.getElementById('password').value,365);document.getElementById('url').disabled=true;document.getElementById('button').value="Disconnect";connected=true;connect(document.getElementById('url').value,document.getElementById('password').value);}}
function prepare_for_connect(){document.getElementById('url').disabled=false;document.getElementById('button').value="Connect";}
function update_file_status(s){document.getElementById('file-status').innerHTML=s;}
function connect(url,password){ws=new WebSocket(url);ws.binaryType='arraybuffer';ws.onopen=function(){term.removeAllListeners('data');term.on('data',function(data){data=data.replace(/\n/g,"\r");ws.send(data);});term.on('title',function(title){document.title=title;});term.focus();term.element.focus();term.write('\x1b[31mWelcome to BIPES Project using MicroPython!\x1b[m\r\n');term.write('\x1b[31mSending password...\x1b[m\r\n');ws.send(password+'\n\n');ws.onmessage=function(event){if(event.data instanceof ArrayBuffer){var data=new Uint8Array(event.data);console.log('binary state = '+binary_state);switch(binary_state){case 11:if(decode_resp(data)==0){for(var offset=0;offset<put_file_data.length;offset+=1024){ws.send(put_file_data.slice(offset,offset+1024));}
binary_state=12;}
break;case 12:if(decode_resp(data)==0){update_file_status('Sent '+put_file_name+', '+put_file_data.length+' bytes');}else{update_file_status('Failed sending '+put_file_name);}
binary_state=0;break;case 21:console.log('get 1');if(decode_resp(data)==0){console.log('get 2');binary_state=22;var rec=new Uint8Array(1);rec[0]=0;ws.send(rec);}
break;case 22:{var sz=data[0]|(data[1]<<8);if(data.length==2+sz){if(sz==0){binary_state=23;}else{var new_buf=new Uint8Array(get_file_data.length+sz);new_buf.set(get_file_data);new_buf.set(data.slice(2),get_file_data.length);get_file_data=new_buf;update_file_status('Getting '+get_file_name+', '+get_file_data.length+' bytes');var rec=new Uint8Array(1);rec[0]=0;ws.send(rec);}}else{binary_state=0;}
break;}
case 23:if(decode_resp(data)==0){update_file_status('Got '+get_file_name+', '+get_file_data.length+' bytes');if(!viewOnly)
saveAs(new Blob([get_file_data],{type:"application/octet-stream"}),get_file_name);else
updateSourceCode(new Blob([get_file_data],{type:"text/plain"}),get_file_name);}else{update_file_status('Failed getting '+get_file_name);}
binary_state=0;break;case 31:console.log('GET_VER',data);binary_state=0;break;}}
term.write(event.data);received_string=received_string.concat(event.data);};};ws.onclose=function(){connected=false;if(term){term.write('\x1b[31mDisconnected\x1b[m\r\n');}
term.off('data');prepare_for_connect();}}
function decode_resp(data){if(data[0]=='W'.charCodeAt(0)&&data[1]=='B'.charCodeAt(0)){var code=data[2]|(data[3]<<8);return code;}else{return-1;}}
function put_file(){var dest_fname=put_file_name;var dest_fsize=put_file_data.length;var rec=new Uint8Array(2+1+1+8+4+2+64);rec[0]='W'.charCodeAt(0);rec[1]='A'.charCodeAt(0);rec[2]=1;rec[3]=0;rec[4]=0;rec[5]=0;rec[6]=0;rec[7]=0;rec[8]=0;rec[9]=0;rec[10]=0;rec[11]=0;rec[12]=dest_fsize&0xff;rec[13]=(dest_fsize>>8)&0xff;rec[14]=(dest_fsize>>16)&0xff;rec[15]=(dest_fsize>>24)&0xff;rec[16]=dest_fname.length&0xff;rec[17]=(dest_fname.length>>8)&0xff;for(var i=0;i<64;++i){if(i<dest_fname.length){rec[18+i]=dest_fname.charCodeAt(i);}else{rec[18+i]=0;}}
binary_state=11;update_file_status('Sending '+put_file_name+'...');ws.send(rec);}
function get_file2(src_fname){var rec=new Uint8Array(2+1+1+8+4+2+64);rec[0]='W'.charCodeAt(0);rec[1]='A'.charCodeAt(0);rec[2]=2;rec[3]=0;rec[4]=0;rec[5]=0;rec[6]=0;rec[7]=0;rec[8]=0;rec[9]=0;rec[10]=0;rec[11]=0;rec[12]=0;rec[13]=0;rec[14]=0;rec[15]=0;rec[16]=src_fname.length&0xff;rec[17]=(src_fname.length>>8)&0xff;for(var i=0;i<64;++i){if(i<src_fname.length){rec[18+i]=src_fname.charCodeAt(i);}else{rec[18+i]=0;}}
binary_state=21;get_file_name=src_fname;get_file_data=new Uint8Array(0);update_file_status('Getting '+get_file_name+'...');ws.send(rec);}
function get_file(){var src_fname=document.getElementById('get_filename').value;var rec=new Uint8Array(2+1+1+8+4+2+64);rec[0]='W'.charCodeAt(0);rec[1]='A'.charCodeAt(0);rec[2]=2;rec[3]=0;rec[4]=0;rec[5]=0;rec[6]=0;rec[7]=0;rec[8]=0;rec[9]=0;rec[10]=0;rec[11]=0;rec[12]=0;rec[13]=0;rec[14]=0;rec[15]=0;rec[16]=src_fname.length&0xff;rec[17]=(src_fname.length>>8)&0xff;for(var i=0;i<64;++i){if(i<src_fname.length){rec[18+i]=src_fname.charCodeAt(i);}else{rec[18+i]=0;}}
binary_state=21;get_file_name=src_fname;get_file_data=new Uint8Array(0);update_file_status('Getting '+get_file_name+'...');ws.send(rec);}
function get_ver(){var rec=new Uint8Array(2+1+1+8+4+2+64);rec[0]='W'.charCodeAt(0);rec[1]='A'.charCodeAt(0);rec[2]=3;binary_state=31;ws.send(rec);}
function handle_put_file_select(evt){var files=evt.target.files;var f=files[0];put_file_name=f.name;var reader=new FileReader();reader.onload=function(e){put_file_data=new Uint8Array(e.target.result);document.getElementById('put-file-list').innerHTML=''+escape(put_file_name)+' - '+put_file_data.length+' bytes';document.getElementById('put-file-button').disabled=false;};reader.readAsArrayBuffer(f);}
document.getElementById('put-file-select').addEventListener('click',function(){this.value=null;},false);document.getElementById('put-file-select').addEventListener('change',handle_put_file_select,false);document.getElementById('put-file-button').disabled=true;function sleep(milliseconds){const date=Date.now();let currentDate=null;do{currentDate=Date.now();}while(currentDate-date<milliseconds);}
function stopPython(evt){ws.send('\x03');}
function saveXml(){Code.tabClick('xml');var xmlTextarea=document.getElementById('content_xml');var xmlText=xmlTextarea.value;filename="mpy_blocks";fileExt=".xml";var blob=new Blob([xmlText],{type:"text/plain;charset=utf-8"});if(blob.size!=0)
saveAs(blob,filename+fileExt);}
function loadXmlDom(event){var files=event.target.files;if(files.length!=1){return;}
var reader=new FileReader();reader.onloadend=function(event){var target=event.target;if(target.readyState==2){try{var xml=Blockly.Xml.textToDom(target.result);}catch(e){alert('Parsed XML Error:\n'+e);return;}
Code.discard();Blockly.Xml.domToWorkspace(xml,Code.workspace);}
document.getElementById('load').value='';};reader.readAsText(files[0]);}
function loadXml(){var loadInput=document.getElementById('load');loadInput.addEventListener('change',loadXmlDom,false);loadInput.click();}
function runPythonCode(pCodeIn){if(!connected){alert('Must be connected to run code');return;}
var code=pCodeIn;var textArray=code.split(/\r\n|\r|\n/);console.log(code);ws.send('\x05');sleep(10);textArray.forEach(function(line,index,array){ws.send(line+'\r');sleep(100);});ws.send('\x04');}
function runPython(evt){var devSel=document.getElementById("device_selector").value;if(devSel=="UNO"){alert("Generating code for Arduino Uno");var code=Blockly.Arduino.workspaceToCode(Code.workspace);return;}
if(!connected){alert('Must be connected to run code');return;}
var code=Blockly.Python.workspaceToCode(Code.workspace);var textArray=code.split(/\r\n|\r|\n/);Code.tabClick('console');console.log(code);ws.send('\x05');sleep(50);textArray.forEach(function(line,index,array){ws.send(line+'\r');sleep(100);});ws.send('\x04');}
function files_run(file){update_file_status('Executing  '+file);fileS=file.split('.')[0];ws.send('exec(open(\'./'+file+'\').read(),globals())'+'\r');}
function files_delete(file){msg="Are you sure you want to delete "+file+"?";if(confirm(msg)){txt="Will delete file "+file;ws.send('os.remove(\''+file+'\')\r');setTimeout(updateTable,350);update_file_status('Deleted  '+file);}else{txt="Delete aborted";update_file_status('Delete aborted for '+file);}}
function blocksToPython(){var code=Blockly.Python.workspaceToCode(Code.workspace);editor.getDoc().setValue(code);}
function files_save_as(){var file=document.getElementById('content_file_name');var codeStr=editor.getDoc().getValue("\n")
var bufCode=new Uint8Array(codeStr.length);for(var i=0,strLen=codeStr.length;i<strLen;i++){bufCode[i]=codeStr.charCodeAt(i);}
put_file_name=file.value;put_file_data=bufCode;put_file();}
function updateSourceCode(code,file_name){blb=code;const reader=new FileReader();text="";reader.addEventListener('loadend',(e)=>{text=e.srcElement.result;console.log(text);var Textarea=document.getElementById('content_file_code');editor.getDoc().setValue(text);var TextareaF=document.getElementById('content_file_name');TextareaF.value=file_name;});reader.readAsText(blb);}
function files_view(file){str="Loading "+file;viewOnly=true;get_file2(file);update_file_status('Downloading '+file);str="Loaded "+file;}
function files_download(file){str="Download "+file;viewOnly=false;get_file2(file);update_file_status('Downloading '+file);}
function updateTable(evt){filesA=received_string.split('[')[1];filesB=filesA.split(']')[0];filesC=filesB.split('"'[0]);filesD=eval("["+filesC+"]");fileTable="Device File List: <br> <br> <table border=2> ";fileTable+="<tr><td><center>File</center></td><td><center>Actions</center></td><td>Run at boot?</td></tr>";for(var i=0,len=filesD.length;i<len;i++){file=filesD[i];fileTable+="<tr><td>"+file+"</td><td>";fileTable+='<input type=button value=Run onclick="files_run(\''+file+'\'); return false;" />';fileTable+='<input type=button value=Open onclick="files_view(\''+file+'\'); return false;" />';fileTable+='<input type=button value=Download onclick="files_download(\''+file+'\'); return false;" />';fileTable+='<input type=button value=Delete onclick="files_delete(\''+file+'\'); return false;" />';if((file=="boot.py")||(file=="main.py"))
fileTable+="</td><td><center>Yes</center></td></tr>";else
fileTable+="</td><td><center>No</center></td></tr>";}
fileTable+="</table>";dom=document.getElementById("fileList");dom.innerHTML=fileTable;}
function listFiles(evt){if(!connected){alert('Must be connected to list files');return;}
received_string="";ws.send('import os\r');sleep(25);ws.send('os.listdir()\r');setTimeout(updateTable,250);}</script>
</html>