<!DOCTYPE html>
<html lang=big5>
<head>
<meta charset=utf-8>
<title>JSON資料產生器 - MQTT版</title>
<style>.scrollable-div{height:200px;overflow:auto;border:1px solid #ccc}form h1{margin-bottom:5px;color:#333}label{width:100px;margin-right:10px;color:#555;text-align:right}input,textarea{flex:1;padding:5px;border:1px solid #ccc;border-radius:5px;font-size:16px;background-color:#fff}button{padding:10px 10px;border:0;border-radius:5px;background-color:#007bff;color:#fff;font-size:16px;cursor:pointer}button:hover{background-color:#0056b3}button[type="reset"]{background-color:#6c757d}button[type="reset"]:hover{background-color:#5a6268}</style>
</head>
<body>
<h1>JSON資料產生器 - MQTT版</h1>
<form id=mqttForm class=form-group>
<label for=brokerHost>Broker主機：</label>
<input type=text id=brokerHost required value=broker.hivemq.com> &nbsp; &nbsp;
<label for=brokerPort>埠號：</label>
<input type=text id=brokerPort required value=8000><br><br>
<button type=button onclick=connectBroker()>連線至MQTT Broker</button> &nbsp;<small><span id=client_id></span></small><br><br>
<label for=stdno>學號（共8位數的數字）：</label>
<input type=text id=stdno required value=12345678><br><br>
<label for=mqttTopic>MQTT主題：</label>
<input type=text id=mqttTopic required value=sensors/livingroom/data><br><br>
<label for=publishInterval>出版間隔時間（毫秒）：</label>
<input type=number id=publishInterval required value=3000><br><br>
<button type=button onclick=startPublishing()>開始出版訊息</button>
<button type=button onclick=stopPublishing()>停止出版訊息</button>
</form><br>
<div id=status style=color:red></div><br>
<div id=output style=color:blue class=scrollable-div></div>
<script>var mqttClient;var isConnected=false;var timer;let type=["IoT電腦教室1","IoT電腦教室2","IoT研究室1","IoT研究室2","IoT實習工廠1","IoT實習工廠2","IoT上課教室1","IoT上課教室2"];var dataObj;var stdno;function generateClientID(){var characters="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";var timestamp=new Date().getTime();var seed=timestamp;var uniqueCode='';for(var i=0;i<15;i++){seed=(seed*9301+49297)%233280;var randomIndex=Math.floor(seed/233280*characters.length);uniqueCode+=characters.charAt(randomIndex);}
return uniqueCode;}
function connectBroker(){var brokerHost=document.getElementById('brokerHost').value;var brokerPort=Number(document.getElementById('brokerPort').value);var clientId=generateClientID();document.getElementById("client_id").innerHTML='<b>Client Id: </b>'+clientId;mqttClient=new Messaging.Client(brokerHost,brokerPort,clientId);mqttClient.onConnectionLost=onConnectionLost;mqttClient.connect({onSuccess:onConnect});}
function onConnect(){isConnected=true;document.getElementById("status").innerHTML='成功連線至Broker';document.getElementById("output").innerHTML='';}
function onConnectionLost(responseObject){if(responseObject.errorCode!==0){isConnected=false;document.getElementById("status").innerHTML='連線失敗: '+responseObject.errorMessage;}}
function startPublishing(){if(!isConnected){document.getElementById("status").innerHTML='請先連線至Broker';return;}
var mqttTopic=document.getElementById('mqttTopic').value;var publishInterval=Number(document.getElementById('publishInterval').value);var stdno=document.getElementById("stdno").value;timer=setInterval(function(){var date=new Date();if(isConnected){if(stdno&&stdno.length==8){var result=stdno.trim();var no=result.substr(result.length-3)+sumStr(result)+1;var mod=no%8;if(mod==1){dataObj={main:[{id:no,type:type[getRandomInt(1,100)%8],brightness:getRandomInt(100,200)}],sensors:[{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90),data1:{distance:getRandomInt(10,100)}}]}}
if(mod==2){dataObj={main:[{id:no,type:type[getRandomInt(1,100)%8]}],data2:[{brightness:getRandomInt(100,200),distance:getRandomInt(10,100),sensor3:[{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90),}]}]}}
if(mod==3){dataObj={main:[{id:no,type:type[getRandomInt(1,100)%8]}],distance:getRandomInt(10,100),data1:{brightness:getRandomInt(100,200),sensors:[{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90),}]}}}
if(mod==4){dataObj={main:[{id:no,type:type[getRandomInt(1,100)%8]}],sensor1:{temperature:getRandomInt(15,35),data2:[{humidity:getRandomInt(78,90),brightness:getRandomInt(100,200),distance:getRandomInt(10,100)}]}}}
if(mod==5){dataObj={main:[{id:no,type:type[getRandomInt(1,100)%8]}],sensors:[{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90),data1:{brightness:getRandomInt(100,200),distance:getRandomInt(10,100)}}]}}
if(mod==6){dataObj={main:{id:no,type:type[getRandomInt(1,100)%8]},data2:[{sensor2:{temperature:getRandomInt(15,35)},data3:{humidity:getRandomInt(78,90),brightness:getRandomInt(100,200)},distance:getRandomInt(10,100)}]}}
if(mod==7){dataObj={id:no,lab:{type:type[getRandomInt(1,100)%8]},sensors:[{temperature:getRandomInt(15,35),data1:[{humidity:getRandomInt(78,90)}],brightness:getRandomInt(100,200),distance:getRandomInt(10,100),}]}}
if(mod==8){dataObj={id:no,lab:{type:type[getRandomInt(1,100)%8]},data2:[{temperature:getRandomInt(15,35),sensor3:{humidity:getRandomInt(78,90)},brightness:getRandomInt(100,200),distance:getRandomInt(10,100)}]}}
if(mod==9){dataObj={id:no,lab:[{type:type[getRandomInt(1,100)%8]}],data1:{sensor1:{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90)},sensor2:[{brightness:getRandomInt(100,200),distance:getRandomInt(10,100)}]}}}
if(mod==0){dataObj={id:no,lab:[{type:type[getRandomInt(1,100)%8]}],sensors:{temperature:getRandomInt(15,35),humidity:getRandomInt(78,90),data2:[{test:{brightness:getRandomInt(100,200),distance:getRandomInt(10,100)}}]}}}}
else{dataObj={error:"Error!",};}
let dataStr=JSON.stringify(dataObj);var message=new Messaging.Message(dataStr);message.destinationName=mqttTopic;mqttClient.send(message);document.getElementById("output").innerHTML+=date.toLocaleString()+' -> 主題: '+mqttTopic+'，訊息: '+dataStr+"<br>";var scrollableDiv=document.querySelector('.scrollable-div');scrollableDiv.scrollTop=scrollableDiv.scrollHeight;}},publishInterval);}
function stopPublishing(){clearInterval(timer);document.getElementById("output").innerHTML+="出版MQTT訊息已停止。<br>";mqttClient.disconnect();isConnected=false;document.getElementById("status").innerHTML='已經中斷連線Broker';var scrollableDiv=document.querySelector('.scrollable-div');scrollableDiv.scrollTop=scrollableDiv.scrollHeight;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min;}
const sumStr=str=>{const strArr=str.split("");let res=0;for(let i=0;i<strArr.length;i++)
if(+strArr[i])res+=+strArr[i];return res;};</script>
<script>Messaging=(function(global){var version="0.0.0.0";var buildLevel="@BUILDLEVEL@";var MESSAGE_TYPE={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14};var validate=function(obj,keys){for(key in obj){if(obj.hasOwnProperty(key)){if(keys.hasOwnProperty(key)){if(typeof obj[key]!==keys[key])
throw new Error(format(ERROR.INVALID_TYPE,[typeof obj[key],key]));}else{var errorStr="Unknown property, "+key+". Valid properties are:";for(key in keys)
if(keys.hasOwnProperty(key))
errorStr=errorStr+" "+key;throw new Error(errorStr);}}}};var scope=function(f,scope){return function(){return f.apply(scope,arguments);};};var ERROR={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error."},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},};var CONNACK_RC={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"};var format=function(error,substitutions){var text=error.text;if(substitutions){for(var i=0;i<substitutions.length;i++){field="{"+i+"}";start=text.indexOf(field);if(start>0){var part1=text.substring(0,start);var part2=text.substring(start+field.length);text=part1+substitutions[i]+part2;}}}
return text;};var MqttProtoIdentifier=[0x00,0x06,0x4d,0x51,0x49,0x73,0x64,0x70,0x03];var WireMessage=function(type,options){this.type=type;for(name in options){if(options.hasOwnProperty(name)){this[name]=options[name];}}};WireMessage.prototype.encode=function(){var first=((this.type&0x0f)<<4);remLength=0;topicStrLength=new Array();if(this.messageIdentifier!=undefined)
remLength+=2;switch(this.type){case MESSAGE_TYPE.CONNECT:remLength+=MqttProtoIdentifier.length+3;remLength+=UTF8Length(this.clientId)+2;if(this.willMessage!=undefined){remLength+=UTF8Length(this.willMessage.destinationName)+2;var willMessagePayloadBytes=this.willMessage.payloadBytes;if(!(willMessagePayloadBytes instanceof Uint8Array))
willMessagePayloadBytes=new Uint8Array(payloadBytes);remLength+=willMessagePayloadBytes.byteLength+2;}
if(this.userName!=undefined)
remLength+=UTF8Length(this.userName)+2;if(this.password!=undefined)
remLength+=UTF8Length(this.password)+2;break;case MESSAGE_TYPE.SUBSCRIBE:first|=0x02;for(var i=0;i<this.topics.length;i++){topicStrLength[i]=UTF8Length(this.topics[i]);remLength+=topicStrLength[i]+2;}
remLength+=this.requestedQos.length;break;case MESSAGE_TYPE.UNSUBSCRIBE:first|=0x02;for(var i=0;i<this.topics.length;i++){topicStrLength[i]=UTF8Length(this.topics[i]);remLength+=topicStrLength[i]+2;}
break;case MESSAGE_TYPE.PUBLISH:if(this.payloadMessage.duplicate)first|=0x08;first=first|=(this.payloadMessage.qos<<1);if(this.payloadMessage.retained)first|=0x01;destinationNameLength=UTF8Length(this.payloadMessage.destinationName);remLength+=destinationNameLength+2;var payloadBytes=this.payloadMessage.payloadBytes;remLength+=payloadBytes.byteLength;if(payloadBytes instanceof ArrayBuffer)
payloadBytes=new Uint8Array(payloadBytes);else if(!(payloadBytes instanceof Uint8Array))
payloadBytes=new Uint8Array(payloadBytes.buffer);break;case MESSAGE_TYPE.DISCONNECT:break;default:;}
var mbi=encodeMBI(remLength);var pos=mbi.length+1;var buffer=new ArrayBuffer(remLength+pos);var byteStream=new Uint8Array(buffer);byteStream[0]=first;byteStream.set(mbi,1);if(this.type==MESSAGE_TYPE.PUBLISH)
pos=writeString(this.payloadMessage.destinationName,destinationNameLength,byteStream,pos);else if(this.type==MESSAGE_TYPE.CONNECT){byteStream.set(MqttProtoIdentifier,pos);pos+=MqttProtoIdentifier.length;var connectFlags=0;if(this.cleanSession)
connectFlags=0x02;if(this.willMessage!=undefined){connectFlags|=0x04;connectFlags|=(this.willMessage.qos<<3);if(this.willMessage.retained){connectFlags|=0x20;}}
if(this.userName!=undefined)
connectFlags|=0x80;if(this.password!=undefined)
connectFlags|=0x40;byteStream[pos++]=connectFlags;pos=writeUint16(this.keepAliveInterval,byteStream,pos);}
if(this.messageIdentifier!=undefined)
pos=writeUint16(this.messageIdentifier,byteStream,pos);switch(this.type){case MESSAGE_TYPE.CONNECT:pos=writeString(this.clientId,UTF8Length(this.clientId),byteStream,pos);if(this.willMessage!=undefined){pos=writeString(this.willMessage.destinationName,UTF8Length(this.willMessage.destinationName),byteStream,pos);pos=writeUint16(willMessagePayloadBytes.byteLength,byteStream,pos);byteStream.set(willMessagePayloadBytes,pos);pos+=willMessagePayloadBytes.byteLength;}
if(this.userName!=undefined)
pos=writeString(this.userName,UTF8Length(this.userName),byteStream,pos);if(this.password!=undefined)
pos=writeString(this.password,UTF8Length(this.password),byteStream,pos);break;case MESSAGE_TYPE.PUBLISH:byteStream.set(payloadBytes,pos);break;case MESSAGE_TYPE.SUBSCRIBE:for(var i=0;i<this.topics.length;i++){pos=writeString(this.topics[i],topicStrLength[i],byteStream,pos);byteStream[pos++]=this.requestedQos[i];}
break;case MESSAGE_TYPE.UNSUBSCRIBE:for(var i=0;i<this.topics.length;i++)
pos=writeString(this.topics[i],topicStrLength[i],byteStream,pos);break;default:}
return buffer;}
function decodeMessage(input){var first=input[0];var type=first>>4;var messageInfo=first&=0x0f;var pos=1;var digit;var remLength=0;var multiplier=1;do{digit=input[pos++];remLength+=((digit&0x7F)*multiplier);multiplier*=128;}while((digit&0x80)!=0);var wireMessage=new WireMessage(type);switch(type){case MESSAGE_TYPE.CONNACK:wireMessage.topicNameCompressionResponse=input[pos++];wireMessage.returnCode=input[pos++];break;case MESSAGE_TYPE.PUBLISH:var qos=(messageInfo>>1)&0x03;var len=readUint16(input,pos);pos+=2;var topicName=parseUTF8(input,pos,len);pos+=len;if(qos>0){wireMessage.messageIdentifier=readUint16(input,pos);pos+=2;}
var message=new Messaging.Message(input.subarray(pos));if((messageInfo&0x01)==0x01)
message.retained=true;if((messageInfo&0x08)==0x08)
message.duplicate=true;message.qos=qos;message.destinationName=topicName;wireMessage.payloadMessage=message;break;case MESSAGE_TYPE.PUBACK:case MESSAGE_TYPE.PUBREC:case MESSAGE_TYPE.PUBREL:case MESSAGE_TYPE.PUBCOMP:case MESSAGE_TYPE.UNSUBACK:wireMessage.messageIdentifier=readUint16(input,pos);break;case MESSAGE_TYPE.SUBACK:wireMessage.messageIdentifier=readUint16(input,pos);pos+=2;wireMessage.grantedQos=input.subarray(pos);break;default:;}
return wireMessage;}
function writeUint16(input,buffer,offset){buffer[offset++]=input>>8;buffer[offset++]=input%256;return offset;}
function writeString(input,utf8Length,buffer,offset){offset=writeUint16(utf8Length,buffer,offset);stringToUTF8(input,buffer,offset);return offset+utf8Length;}
function readUint16(buffer,offset){return 256*buffer[offset]+buffer[offset+1];}
function encodeMBI(number){var output=new Array(1);var numBytes=0;do{var digit=number%128;number=number>>7;if(number>0){digit|=0x80;}
output[numBytes++]=digit;}while((number>0)&&(numBytes<4));return output;}
function UTF8Length(input){var output=0;for(var i=0;i<input.length;i++){var charCode=input.charCodeAt(i);if(charCode>0x7FF){if(0xD800<=charCode&&charCode<=0xDBFF){i++;output++;}
output+=3;}
else if(charCode>0x7F)
output+=2;else
output++;}
return output;}
function stringToUTF8(input,output,start){var pos=start;for(var i=0;i<input.length;i++){var charCode=input.charCodeAt(i);if(0xD800<=charCode&&charCode<=0xDBFF){lowCharCode=input.charCodeAt(++i);if(isNaN(lowCharCode)){throw new Error(format(ERROR.MALFORMED_UNICODE,[charCode,lowCharCode]));}
charCode=((charCode-0xD800)<<10)+(lowCharCode-0xDC00)+0x10000;}
if(charCode<=0x7F){output[pos++]=charCode;}else if(charCode<=0x7FF){output[pos++]=charCode>>6&0x1F|0xC0;output[pos++]=charCode&0x3F|0x80;}else if(charCode<=0xFFFF){output[pos++]=charCode>>12&0x0F|0xE0;output[pos++]=charCode>>6&0x3F|0x80;output[pos++]=charCode&0x3F|0x80;}else{output[pos++]=charCode>>18&0x07|0xF0;output[pos++]=charCode>>12&0x3F|0x80;output[pos++]=charCode>>6&0x3F|0x80;output[pos++]=charCode&0x3F|0x80;};}
return output;}
function parseUTF8(input,offset,length){var output="";var utf16;var pos=offset;while(pos<offset+length){var byte1=input[pos++];if(byte1<128)
utf16=byte1;else{var byte2=input[pos++]-128;if(byte2<0)
throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),""]));if(byte1<0xE0)
utf16=64*(byte1-0xC0)+byte2;else{var byte3=input[pos++]-128;if(byte3<0)
throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16)]));if(byte1<0xF0)
utf16=4096*(byte1-0xE0)+64*byte2+byte3;else{var byte4=input[pos++]-128;if(byte4<0)
throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16),byte4.toString(16)]));if(byte1<0xF8)
utf16=262144*(byte1-0xF0)+4096*byte2+64*byte3+byte4;else
throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16),byte4.toString(16)]));}}}
if(utf16>0xFFFF)
{utf16-=0x10000;output+=String.fromCharCode(0xD800+(utf16>>10));utf16=0xDC00+(utf16&0x3FF);}
output+=String.fromCharCode(utf16);}
return output;}
var Pinger=function(client,window,keepAliveInterval){this._client=client;this._window=window;this._keepAliveInterval=keepAliveInterval*1000;this.isReset=false;var pingReq=new WireMessage(MESSAGE_TYPE.PINGREQ).encode();var doTimeout=function(pinger){return function(){return doPing.apply(pinger);};};var doPing=function(){if(!this.isReset){this._client._trace("Pinger.doPing","Timed out");this._client._disconnected(ERROR.PING_TIMEOUT.code,format(ERROR.PING_TIMEOUT));}else{this.isReset=false;this._client._trace("Pinger.doPing","send PINGREQ");this._client.socket.send(pingReq);this.timeout=this._window.setTimeout(doTimeout(this),this._keepAliveInterval);}}
this.reset=function(){this.isReset=true;this._window.clearTimeout(this.timeout);if(this._keepAliveInterval>0)
this.timeout=setTimeout(doTimeout(this),this._keepAliveInterval);}
this.cancel=function(){this._window.clearTimeout(this.timeout);}};var Timeout=function(client,window,timeoutSeconds,action,args){this._window=window;if(!timeoutSeconds)
timeoutSeconds=30;var doTimeout=function(action,client,args){return function(){return action.apply(client,args);};};this.timeout=setTimeout(doTimeout(action,client,args),timeoutSeconds*1000);this.cancel=function(){this._window.clearTimeout(this.timeout);}};var ClientImpl=function(host,port,clientId){if(!("WebSocket"in global&&global["WebSocket"]!==null)){throw new Error(format(ERROR.UNSUPPORTED,["WebSocket"]));}
if(!("localStorage"in global&&global["localStorage"]!==null)){throw new Error(format(ERROR.UNSUPPORTED,["localStorage"]));}
if(!("ArrayBuffer"in global&&global["ArrayBuffer"]!==null)){throw new Error(format(ERROR.UNSUPPORTED,["ArrayBuffer"]));}
this._trace("Messaging.Client",host,port,clientId);this.host=host;this.port=port;this.clientId=clientId;this._localKey=host+":"+port+":"+clientId+":";this._msg_queue=[];this._sentMessages={};this._receivedMessages={};this._notify_msg_sent={};this._message_identifier=1;this._sequence=0;for(key in localStorage)
if(key.indexOf("Sent:"+this._localKey)==0||key.indexOf("Received:"+this._localKey)==0)
this.restore(key);};ClientImpl.prototype.host;ClientImpl.prototype.port;ClientImpl.prototype.clientId;ClientImpl.prototype.socket;ClientImpl.prototype.connected=false;ClientImpl.prototype.maxMessageIdentifier=65536;ClientImpl.prototype.connectOptions;ClientImpl.prototype.hostIndex;ClientImpl.prototype.onConnectionLost;ClientImpl.prototype.onMessageDelivered;ClientImpl.prototype.onMessageArrived;ClientImpl.prototype._msg_queue=null;ClientImpl.prototype._connectTimeout;ClientImpl.prototype.sendPinger=null;ClientImpl.prototype.receivePinger=null;ClientImpl.prototype._traceBuffer=null;ClientImpl.prototype._MAX_TRACE_ENTRIES=100;ClientImpl.prototype.connect=function(connectOptions){var connectOptionsMasked=this._traceMask(connectOptions,"password");this._trace("Client.connect",connectOptionsMasked,this.socket,this.connected);if(this.connected)
throw new Error(format(ERROR.INVALID_STATE,["already connected"]));if(this.socket)
throw new Error(format(ERROR.INVALID_STATE,["already connected"]));this.connectOptions=connectOptions;if(connectOptions.hosts){this.hostIndex=0;this._doConnect(connectOptions.hosts[0],connectOptions.ports[0]);}else{this._doConnect(this.host,this.port);}};ClientImpl.prototype.subscribe=function(filter,subscribeOptions){this._trace("Client.subscribe",filter,subscribeOptions);if(!this.connected)
throw new Error(format(ERROR.INVALID_STATE,["not connected"]));var wireMessage=new WireMessage(MESSAGE_TYPE.SUBSCRIBE);wireMessage.topics=[filter];if(subscribeOptions.qos!=undefined)
wireMessage.requestedQos=[subscribeOptions.qos];else
wireMessage.requestedQos=[0];if(subscribeOptions.onSuccess){wireMessage.callback=function(){subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext});};}
if(subscribeOptions.timeout){wireMessage.timeOut=new Timeout(this,window,subscribeOptions.timeout,subscribeOptions.onFailure,[{invocationContext:subscribeOptions.invocationContext,errorCode:ERROR.SUBSCRIBE_TIMEOUT.code,errorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}]);}
this._requires_ack(wireMessage);this._schedule_message(wireMessage);};ClientImpl.prototype.unsubscribe=function(filter,unsubscribeOptions){this._trace("Client.unsubscribe",filter,unsubscribeOptions);if(!this.connected)
throw new Error(format(ERROR.INVALID_STATE,["not connected"]));var wireMessage=new WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);wireMessage.topics=[filter];if(unsubscribeOptions.onSuccess){wireMessage.callback=function(){unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext});};}
if(unsubscribeOptions.timeout){wireMessage.timeOut=new Timeout(this,window,unsubscribeOptions.timeout,unsubscribeOptions.onFailure,[{invocationContext:unsubscribeOptions.invocationContext,errorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,errorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}]);}
this._requires_ack(wireMessage);this._schedule_message(wireMessage);};ClientImpl.prototype.send=function(message){this._trace("Client.send",message);if(!this.connected)
throw new Error(format(ERROR.INVALID_STATE,["not connected"]));wireMessage=new WireMessage(MESSAGE_TYPE.PUBLISH);wireMessage.payloadMessage=message;if(message.qos>0)
this._requires_ack(wireMessage);else if(this.onMessageDelivered)
this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage);this._schedule_message(wireMessage);};ClientImpl.prototype.disconnect=function(){this._trace("Client.disconnect");if(!this.socket)
throw new Error(format(ERROR.INVALID_STATE,["not connecting or connected"]));wireMessage=new WireMessage(MESSAGE_TYPE.DISCONNECT);this._notify_msg_sent[wireMessage]=scope(this._disconnected,this);this._schedule_message(wireMessage);};ClientImpl.prototype.getTraceLog=function(){if(this._traceBuffer!==null){this._trace("Client.getTraceLog",new Date());this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(key in this._sentMessages)
this._trace("_sentMessages ",key,this._sentMessages[key]);for(key in this._receivedMessages)
this._trace("_receivedMessages ",key,this._receivedMessages[key]);return this._traceBuffer;}};ClientImpl.prototype.startTrace=function(){if(this._traceBuffer===null){this._traceBuffer=[];}
this._trace("Client.startTrace",new Date(),version);};ClientImpl.prototype.stopTrace=function(){delete this._traceBuffer;};ClientImpl.prototype._doConnect=function(host,port){if(this.connectOptions.useSSL)
wsurl=["wss://",host,":",port,"/mqtt"].join("");else
wsurl=["ws://",host,":",port,"/mqtt"].join("");this.connected=false;this.socket=new WebSocket(wsurl,'mqttv3.1');this.socket.binaryType='arraybuffer';this.socket.onopen=scope(this._on_socket_open,this);this.socket.onmessage=scope(this._on_socket_message,this);this.socket.onerror=scope(this._on_socket_error,this);this.socket.onclose=scope(this._on_socket_close,this);this.sendPinger=new Pinger(this,window,this.connectOptions.keepAliveInterval);this.receivePinger=new Pinger(this,window,this.connectOptions.keepAliveInterval);this._connectTimeout=new Timeout(this,window,this.connectOptions.timeout,this._disconnected,[ERROR.CONNECT_TIMEOUT.code,format(ERROR.CONNECT_TIMEOUT)]);};ClientImpl.prototype._schedule_message=function(message){this._msg_queue.push(message);if(this.connected){this._process_queue();}};ClientImpl.prototype.store=function(prefix,wireMessage){storedMessage={type:wireMessage.type,messageIdentifier:wireMessage.messageIdentifier,version:1};switch(wireMessage.type){case MESSAGE_TYPE.PUBLISH:if(wireMessage.pubRecReceived)
storedMessage.pubRecReceived=true;storedMessage.payloadMessage={};var hex="";var messageBytes=wireMessage.payloadMessage.payloadBytes;for(var i=0;i<messageBytes.length;i++){if(messageBytes[i]<=0xF)
hex=hex+"0"+messageBytes[i].toString(16);else
hex=hex+messageBytes[i].toString(16);}
storedMessage.payloadMessage.payloadHex=hex;storedMessage.payloadMessage.qos=wireMessage.payloadMessage.qos;storedMessage.payloadMessage.destinationName=wireMessage.payloadMessage.destinationName;if(wireMessage.payloadMessage.duplicate)
storedMessage.payloadMessage.duplicate=true;if(wireMessage.payloadMessage.retained)
storedMessage.payloadMessage.retained=true;if(prefix.indexOf("Sent:")==0){if(wireMessage.sequence===undefined)
wireMessage.sequence=++this._sequence;storedMessage.sequence=wireMessage.sequence;}
break;default:throw Error(format(ERROR.INVALID_STORED_DATA,[key,storedMessage]));}
localStorage.setItem(prefix+this._localKey+wireMessage.messageIdentifier,JSON.stringify(storedMessage));};ClientImpl.prototype.restore=function(key){var value=localStorage.getItem(key);var storedMessage=JSON.parse(value);var wireMessage=new WireMessage(storedMessage.type,storedMessage);switch(storedMessage.type){case MESSAGE_TYPE.PUBLISH:var hex=storedMessage.payloadMessage.payloadHex;var buffer=new ArrayBuffer((hex.length)/2);var byteStream=new Uint8Array(buffer);var i=0;while(hex.length>=2){var x=parseInt(hex.substring(0,2),16);hex=hex.substring(2,hex.length);byteStream[i++]=x;}
var payloadMessage=new Messaging.Message(byteStream);payloadMessage.qos=storedMessage.payloadMessage.qos;payloadMessage.destinationName=storedMessage.payloadMessage.destinationName;if(storedMessage.payloadMessage.duplicate)
payloadMessage.duplicate=true;if(storedMessage.payloadMessage.retained)
payloadMessage.retained=true;wireMessage.payloadMessage=payloadMessage;break;default:throw Error(format(ERROR.INVALID_STORED_DATA,[key,value]));}
if(key.indexOf("Sent:"+this._localKey)==0){this._sentMessages[wireMessage.messageIdentifier]=wireMessage;}else if(key.indexOf("Received:"+this._localKey)==0){this._receivedMessages[wireMessage.messageIdentifier]=wireMessage;}};ClientImpl.prototype._process_queue=function(){var message=null;var fifo=this._msg_queue.reverse();while((message=fifo.pop())){this._socket_send(message);if(this._notify_msg_sent[message]){this._notify_msg_sent[message]();delete this._notify_msg_sent[message];}}};ClientImpl.prototype._requires_ack=function(wireMessage){var messageCount=Object.keys(this._sentMessages).length;if(messageCount>this.maxMessageIdentifier)
throw Error("Too many messages:"+messageCount);while(this._sentMessages[this._message_identifier]!==undefined){this._message_identifier++;}
wireMessage.messageIdentifier=this._message_identifier;this._sentMessages[wireMessage.messageIdentifier]=wireMessage;if(wireMessage.type===MESSAGE_TYPE.PUBLISH){this.store("Sent:",wireMessage);}
if(this._message_identifier===this.maxMessagIdentifier){this._message_identifier=1;}};ClientImpl.prototype._on_socket_open=function(){var wireMessage=new WireMessage(MESSAGE_TYPE.CONNECT,this.connectOptions);wireMessage.clientId=this.clientId;this._socket_send(wireMessage);};ClientImpl.prototype._on_socket_message=function(event){this._trace("Client._on_socket_message",event.data);this.receivePinger.reset();var byteArray=new Uint8Array(event.data);try{var wireMessage=decodeMessage(byteArray);}catch(error){this._disconnected(ERROR.INTERNAL_ERROR.code,format(ERROR.INTERNAL_ERROR,[error.message]));return;}
this._trace("Client._on_socket_message",wireMessage);switch(wireMessage.type){case MESSAGE_TYPE.CONNACK:this._connectTimeout.cancel();if(this.connectOptions.cleanSession){for(key in this._sentMessages){var sentMessage=this._sentMessages[key];localStorage.removeItem("Sent:"+this._localKey+sentMessage.messageIdentifier);}
this._sentMessages={};for(key in this._receivedMessages){var receivedMessage=this._receivedMessages[key];localStorage.removeItem("Received:"+this._localKey+receivedMessage.messageIdentifier);}
this._receivedMessages={};}
if(wireMessage.returnCode===0){this.connected=true;if(this.connectOptions.hosts)
this.hostIndex=this.connectOptions.hosts.length;}else{this._disconnected(ERROR.CONNACK_RETURNCODE.code,format(ERROR.CONNACK_RETURNCODE,[wireMessage.returnCode,CONNACK_RC[wireMessage.returnCode]]));break;}
var sequencedMessages=new Array();for(var msgId in this._sentMessages){if(this._sentMessages.hasOwnProperty(msgId))
sequencedMessages.push(this._sentMessages[msgId]);}
var sequencedMessages=sequencedMessages.sort(function(a,b){return a.sequence-b.sequence;});for(var i=0,len=sequencedMessages.length;i<len;i++){var sentMessage=sequencedMessages[i];if(sentMessage.type==MESSAGE_TYPE.PUBLISH&&sentMessage.pubRecReceived){var pubRelMessage=new WireMessage(MESSAGE_TYPE.PUBREL,{messageIdentifier:sentMessage.messageIdentifier});this._schedule_message(pubRelMessage);}else{this._schedule_message(sentMessage);};}
if(this.connectOptions.onSuccess){this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});}
this._process_queue();break;case MESSAGE_TYPE.PUBLISH:this._receivePublish(wireMessage);break;case MESSAGE_TYPE.PUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){delete this._sentMessages[wireMessage.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+wireMessage.messageIdentifier);if(this.onMessageDelivered)
this.onMessageDelivered(sentMessage.payloadMessage);}
break;case MESSAGE_TYPE.PUBREC:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){sentMessage.pubRecReceived=true;var pubRelMessage=new WireMessage(MESSAGE_TYPE.PUBREL,{messageIdentifier:wireMessage.messageIdentifier});this.store("Sent:",sentMessage);this._schedule_message(pubRelMessage);}
break;case MESSAGE_TYPE.PUBREL:var receivedMessage=this._receivedMessages[wireMessage.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+wireMessage.messageIdentifier);if(receivedMessage){this._receiveMessage(receivedMessage);delete this._receivedMessages[wireMessage.messageIdentifier];}
pubCompMessage=new WireMessage(MESSAGE_TYPE.PUBCOMP,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubCompMessage);break;case MESSAGE_TYPE.PUBCOMP:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];delete this._sentMessages[wireMessage.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+wireMessage.messageIdentifier);if(this.onMessageDelivered)
this.onMessageDelivered(sentMessage.payloadMessage);break;case MESSAGE_TYPE.SUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){if(sentMessage.timeOut)
sentMessage.timeOut.cancel();if(sentMessage.callback){sentMessage.callback();}
delete this._sentMessages[wireMessage.messageIdentifier];}
break;case MESSAGE_TYPE.UNSUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){if(sentMessage.timeOut)
sentMessage.timeOut.cancel();if(sentMessage.callback){sentMessage.callback();}
delete this._sentMessages[wireMessage.messageIdentifier];}
break;case MESSAGE_TYPE.PINGRESP:this.sendPinger.reset();break;case MESSAGE_TYPE.DISCONNECT:this._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code,format(ERROR.INVALID_MQTT_MESSAGE_TYPE,[wireMessage.type]));break;default:this._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code,format(ERROR.INVALID_MQTT_MESSAGE_TYPE,[wireMessage.type]));};};ClientImpl.prototype._on_socket_error=function(error){this._disconnected(ERROR.SOCKET_ERROR.code,format(ERROR.SOCKET_ERROR,[error.data]));};ClientImpl.prototype._on_socket_close=function(){this._disconnected(ERROR.SOCKET_CLOSE.code,format(ERROR.SOCKET_CLOSE));};ClientImpl.prototype._socket_send=function(wireMessage){if(wireMessage.type==1){var wireMessageMasked=this._traceMask(wireMessage,"password");this._trace("Client._socket_send",wireMessageMasked);}
else this._trace("Client._socket_send",wireMessage);this.socket.send(wireMessage.encode());this.sendPinger.reset();};ClientImpl.prototype._receivePublish=function(wireMessage){switch(wireMessage.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(wireMessage);break;case 1:var pubAckMessage=new WireMessage(MESSAGE_TYPE.PUBACK,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubAckMessage);this._receiveMessage(wireMessage);break;case 2:this._receivedMessages[wireMessage.messageIdentifier]=wireMessage;this.store("Received:",wireMessage);var pubRecMessage=new WireMessage(MESSAGE_TYPE.PUBREC,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubRecMessage);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos);};};ClientImpl.prototype._receiveMessage=function(wireMessage){if(this.onMessageArrived){this.onMessageArrived(wireMessage.payloadMessage);}};ClientImpl.prototype._disconnected=function(errorCode,errorText){this._trace("Client._disconnected",errorCode,errorText);this.sendPinger.cancel();this.receivePinger.cancel();if(this._connectTimeout)
this._connectTimeout.cancel();this._msg_queue=[];this._notify_msg_sent={};if(this.socket){this.socket.onopen=null;this.socket.onmessage=null;this.socket.onerror=null;this.socket.onclose=null;if(this.socket.readyState===1)
this.socket.close();delete this.socket;}
if(this.connectOptions.hosts&&this.hostIndex<this.connectOptions.hosts.length-1){this.hostIndex++;this._doConnect(this.connectOptions.hosts[this.hostIndex],this.connectOptions.ports[this.hostIndex]);}else{if(errorCode===undefined){errorCode=ERROR.OK.code;errorText=format(ERROR.OK);}
if(this.connected){this.connected=false;if(this.onConnectionLost)
this.onConnectionLost({errorCode:errorCode,errorMessage:errorText});}else{if(this.connectOptions.onFailure)
this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:errorCode,errorMessage:errorText});}}};ClientImpl.prototype._trace=function(){if(this._traceBuffer!==null){for(var i=0,max=arguments.length;i<max;i++){if(this._traceBuffer.length==this._MAX_TRACE_ENTRIES){this._traceBuffer.shift();}
if(i===0)this._traceBuffer.push(arguments[i]);else if(typeof arguments[i]==="undefined")this._traceBuffer.push(arguments[i]);else this._traceBuffer.push("  "+JSON.stringify(arguments[i]));};};};ClientImpl.prototype._traceMask=function(traceObject,masked){var traceObjectMasked={};for(var attr in traceObject){if(traceObject.hasOwnProperty(attr)){if(attr==masked)
traceObjectMasked[attr]="******";else
traceObjectMasked[attr]=traceObject[attr];}}
return traceObjectMasked;};var Client=function(host,port,clientId){if(typeof host!=="string")
throw new Error(format(ERROR.INVALID_TYPE,[typeof host,"host"]));if(typeof port!=="number"||port<0)
throw new Error(format(ERROR.INVALID_TYPE,[typeof port,"port"]));var clientIdLength=0;for(var i=0;i<clientId.length;i++){var charCode=clientId.charCodeAt(i);if(0xD800<=charCode&&charCode<=0xDBFF){i++;}
clientIdLength++;}
if(typeof clientId!=="string"||clientIdLength<1|clientIdLength>23)
throw new Error(format(ERROR.INVALID_ARGUMENT,[clientId,"clientId"]));var client=new ClientImpl(host,port,clientId);this._getHost=function(){return client.host;};this._setHost=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION));};this._getPort=function(){return client.port;};this._setPort=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION));};this._getClientId=function(){return client.clientId;};this._setClientId=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION));};this._getOnConnectionLost=function(){return client.onConnectionLost;};this._setOnConnectionLost=function(newOnConnectionLost){if(typeof newOnConnectionLost==="function")
client.onConnectionLost=newOnConnectionLost;else
throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnConnectionLost,"onConnectionLost"]));};this._getOnMessageDelivered=function(){return client.onMessageDelivered;};this._setOnMessageDelivered=function(newOnMessageDelivered){if(typeof newOnMessageDelivered==="function")
client.onMessageDelivered=newOnMessageDelivered;else
throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnMessageDelivered,"onMessageDelivered"]));};this._getOnMessageArrived=function(){return client.onMessageArrived;};this._setOnMessageArrived=function(newOnMessageArrived){if(typeof newOnMessageArrived==="function")
client.onMessageArrived=newOnMessageArrived;else
throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnMessageArrived,"onMessageArrived"]));};this.connect=function(connectOptions){connectOptions=connectOptions||{};validate(connectOptions,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object"});if(connectOptions.keepAliveInterval===undefined)
connectOptions.keepAliveInterval=60;if(connectOptions.willMessage){if(!(connectOptions.willMessage instanceof Message))
throw new Error(format(ERROR.INVALID_TYPE,[connectOptions.willMessage,"connectOptions.willMessage"]));connectOptions.willMessage.stringPayload;if(typeof connectOptions.willMessage.destinationName==="undefined")
throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.willMessage.destinationName,"connectOptions.willMessage.destinationName"]));}
if(typeof connectOptions.cleanSession==="undefined")
connectOptions.cleanSession=true;if(connectOptions.hosts){if(!connectOptions.ports)
throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));if(!(connectOptions.hosts instanceof Array))
throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts,"connectOptions.hosts"]));if(!(connectOptions.ports instanceof Array))
throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));if(connectOptions.hosts.length<1)
throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts,"connectOptions.hosts"]));if(connectOptions.hosts.length!=connectOptions.ports.length)
throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));for(var i=0;i<connectOptions.hosts.length;i++){if(typeof connectOptions.hosts[i]!=="string")
throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.hosts[i],"connectOptions.hosts["+i+"]"]));if(typeof connectOptions.ports[i]!=="number"||connectOptions.ports[i]<0)
throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.ports[i],"connectOptions.ports["+i+"]"]));}}
client.connect(connectOptions);};this.subscribe=function(filter,subscribeOptions){if(typeof filter!=="string")
throw new Error("Invalid argument:"+filter);subscribeOptions=subscribeOptions||{};validate(subscribeOptions,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(subscribeOptions.timeout&&!subscribeOptions.onFailure)
throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(typeof subscribeOptions.qos!=="undefined"&&!(subscribeOptions.qos===0||subscribeOptions.qos===1||subscribeOptions.qos===2))
throw new Error(format(ERROR.INVALID_ARGUMENT,[subscribeOptions.qos,"subscribeOptions.qos"]));client.subscribe(filter,subscribeOptions);};this.unsubscribe=function(filter,unsubscribeOptions){if(typeof filter!=="string")
throw new Error("Invalid argument:"+filter);unsubscribeOptions=unsubscribeOptions||{};validate(unsubscribeOptions,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(unsubscribeOptions.timeout&&!unsubscribeOptions.onFailure)
throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");client.unsubscribe(filter,unsubscribeOptions);};this.send=function(message){if(!(message instanceof Message))
throw new Error("Invalid argument:"+typeof message);if(typeof message.destinationName==="undefined")
throw new Error("Invalid parameter Message.destinationName:"+message.destinationName);client.send(message);};this.disconnect=function(){client.disconnect();};this.getTraceLog=function(){return client.getTraceLog();}
this.startTrace=function(){client.startTrace();};this.stopTrace=function(){client.stopTrace();};};Client.prototype={get host(){return this._getHost();},set host(newHost){this._setHost(newHost);},get port(){return this._getPort();},set port(newPort){this._setPort(newPort);},get clientId(){return this._getClientId();},set clientId(newClientId){this._setClientId(newClientId);},get onConnectionLost(){return this._getOnConnectionLost();},set onConnectionLost(newOnConnectionLost){this._setOnConnectionLost(newOnConnectionLost);},get onMessageDelivered(){return this._getOnMessageDelivered();},set onMessageDelivered(newOnMessageDelivered){this._setOnMessageDelivered(newOnMessageDelivered);},get onMessageArrived(){return this._getOnMessageArrived();},set onMessageArrived(newOnMessageArrived){this._setOnMessageArrived(newOnMessageArrived);}};var Message=function(newPayload){var payload;if(typeof newPayload==="string"||newPayload instanceof ArrayBuffer||newPayload instanceof Int8Array||newPayload instanceof Uint8Array||newPayload instanceof Int16Array||newPayload instanceof Uint16Array||newPayload instanceof Int32Array||newPayload instanceof Uint32Array||newPayload instanceof Float32Array||newPayload instanceof Float64Array){payload=newPayload;}else{throw(format(ERROR.INVALID_ARGUMENT,[newPayload,"newPayload"]));}
this._getPayloadString=function(){if(typeof payload==="string")
return payload;else
return parseUTF8(payload,0,payload.length);};this._getPayloadBytes=function(){if(typeof payload==="string"){var buffer=new ArrayBuffer(UTF8Length(payload));var byteStream=new Uint8Array(buffer);stringToUTF8(payload,byteStream,0);return byteStream;}else{return payload;};};var destinationName=undefined;this._getDestinationName=function(){return destinationName;};this._setDestinationName=function(newDestinationName){if(typeof newDestinationName==="string")
destinationName=newDestinationName;else
throw new Error(format(ERROR.INVALID_ARGUMENT,[newDestinationName,"newDestinationName"]));};var qos=0;this._getQos=function(){return qos;};this._setQos=function(newQos){if(newQos===0||newQos===1||newQos===2)
qos=newQos;else
throw new Error("Invalid argument:"+newQos);};var retained=false;this._getRetained=function(){return retained;};this._setRetained=function(newRetained){if(typeof newRetained==="boolean")
retained=newRetained;else
throw new Error(format(ERROR.INVALID_ARGUMENT,[newRetained,"newRetained"]));};var duplicate=false;this._getDuplicate=function(){return duplicate;};this._setDuplicate=function(newDuplicate){duplicate=newDuplicate;};};Message.prototype={get payloadString(){return this._getPayloadString();},get payloadBytes(){return this._getPayloadBytes();},get destinationName(){return this._getDestinationName();},set destinationName(newDestinationName){this._setDestinationName(newDestinationName);},get qos(){return this._getQos();},set qos(newQos){this._setQos(newQos);},get retained(){return this._getRetained();},set retained(newRetained){this._setRetained(newRetained);},get duplicate(){return this._getDuplicate();},set duplicate(newDuplicate){this._setDuplicate(newDuplicate);}};return{Client:Client,Message:Message};})(window);</script>
</body>
</html>